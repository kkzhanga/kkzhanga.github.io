<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>KKZhang’s Blog</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2020-11-27T08:39:04.319Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>kkzhang</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>从零搭建sprinCloud框架（二）</title>
    <link href="http://example.com/2020/11/26/springCloud/buildSprinCloud_2/"/>
    <id>http://example.com/2020/11/26/springCloud/buildSprinCloud_2/</id>
    <published>2020-11-26T06:16:20.000Z</published>
    <updated>2020-11-27T08:39:04.319Z</updated>
    
    <content type="html"><![CDATA[<h1 id="整合gateway"><a href="#整合gateway" class="headerlink" title="整合gateway"></a>整合gateway</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>SpringCloud Gateway成为SpringCloud的重要组件是为了提到替代Netflix Zuul(1.x版本基于过滤器，阻塞IO，不支持长连接，2.x版本一直跳票，2019年5月，开源了支持异步调用模式的Zuul 2.0版本)</p><h2 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h2><ul><li>动态路由</li><li>限流</li><li>跨域</li><li>鉴权，黑白名单机制</li><li>日志记录</li></ul><h3 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h3><h4 id="Gateway与Eureka整合"><a href="#Gateway与Eureka整合" class="headerlink" title="Gateway与Eureka整合"></a>Gateway与Eureka整合</h4><p>原理：网关根据serviceId自动从注册中心获取服务地址并转发请求</p><ul><li>新建eureka微服务：</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">YML配置：</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#当前服务名称</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">eureka-service</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#端口,路径</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10002</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span> <span class="comment">#自身 不在向eureka注册</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span> <span class="comment">#启动时禁用client的注册</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:10002/eureka</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">XML配置：</span></span><br><span class="line"></span><br><span class="line"><span class="string">&lt;dependency&gt;</span></span><br><span class="line">   <span class="string">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></span><br><span class="line">   <span class="string">&lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt;</span></span><br><span class="line"><span class="string">&lt;/dependency&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Java启动类：</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EurekaApp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">( String[] args )</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">       SpringApplication.run(EurekaApp.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>新建gateway微服务：</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">YML配置：</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#当前服务名称</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway-server</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">discovery:</span>                         <span class="comment"># 是否与服务发现组件进行结合，通过 serviceId 转发到具体服务实例。</span></span><br><span class="line">        <span class="attr">locator:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span>                  <span class="comment"># 是否开启基于服务发现的路由规则</span></span><br><span class="line">          <span class="attr">lower-case-service-id:</span> <span class="literal">true</span>    <span class="comment"># 是否将服务名称转小写</span></span><br><span class="line">      <span class="attr">routes:</span>                      <span class="comment"># 路由规则</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">order-service</span>           <span class="comment"># 路由 ID，唯一</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">lb://order-service</span>   <span class="comment"># 目标 URI，路由到微服务的地址</span></span><br><span class="line">        <span class="attr">predicates:</span>                   <span class="comment"># 断言（判断条件）</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Path=/order/**</span>          <span class="comment"># 匹配对应 URL 的请求，将匹配到的请求追加在目标 URI 之后</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#端口,路径</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">11111</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置 Eureka Server 注册中心</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:10002/eureka</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">XML配置：</span></span><br><span class="line"></span><br><span class="line"><span class="string">&lt;dependency&gt;</span></span><br><span class="line">   <span class="string">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></span><br><span class="line">   <span class="string">&lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt;</span></span><br><span class="line"><span class="string">&lt;/dependency&gt;</span></span><br><span class="line"><span class="string">&lt;dependency&gt;</span></span><br><span class="line">   <span class="string">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></span><br><span class="line">   <span class="string">&lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;</span></span><br><span class="line"><span class="string">&lt;/dependency&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Java启动类：</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GatewayApp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">( String[] args )</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        SpringApplication.run(GatewayApp.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>新建order微服务：</p><p>根据上面示例创建两个端口不同，名称一致的微服务提供者，模拟集群多示例（略）。</p></li></ul><ul><li><p>验证</p><p><img src="https://i.loli.net/2020/11/27/8cILNv23TKGpHj9.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/27/8cILNv23TKGpHj9.png" srcset="data:image/png;base64,666" alt="20201127_1.jpg"><br>打开eureka控制台我们就可以看到order已经有了两个实例，通过多次点击查询，返回不同实例值。证明达到了负载均衡的效果(eureka集成了ribbon，默认使用的负载均衡策略是轮询，这个后续待研究)</p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;整合gateway&quot;&gt;&lt;a href=&quot;#整合gateway&quot; class=&quot;headerlink&quot; title=&quot;整合gateway&quot;&gt;&lt;/a&gt;整合gateway&lt;/h1&gt;&lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; </summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>从零搭建sprinCloud框架（一）</title>
    <link href="http://example.com/2020/11/19/springCloud/buildSprinCloud_1/"/>
    <id>http://example.com/2020/11/19/springCloud/buildSprinCloud_1/</id>
    <published>2020-11-19T08:43:07.000Z</published>
    <updated>2020-11-27T03:56:54.506Z</updated>
    
    <content type="html"><![CDATA[<p>本项目基于idea+maven组合</p><h2 id="项目父工程配置"><a href="#项目父工程配置" class="headerlink" title="项目父工程配置"></a>项目父工程配置</h2><h3 id="Idea创建工程："><a href="#Idea创建工程：" class="headerlink" title="Idea创建工程："></a>Idea创建工程：</h3><ol><li><p>File -&gt; New -&gt; Project<br><img src="https://i.loli.net/2020/11/26/NBF8rXovSbeYOWG.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/26/NBF8rXovSbeYOWG.png" srcset="data:image/png;base64,666" alt="1606358078.jpg"></p></li><li><p>Empty Project -&gt;Next<br><img src="https://i.loli.net/2020/11/19/zK9nLFk1MbWvsNQ.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/19/zK9nLFk1MbWvsNQ.png" srcset="data:image/png;base64,666" alt="20201119_1.jpg"></p></li><li><p>项目命名 -&gt; 项目位置-&gt; Finish<br><img src="https://i.loli.net/2020/11/19/h9vF4OrxuwPidCp.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/19/h9vF4OrxuwPidCp.png" srcset="data:image/png;base64,666" alt="20201119_2.jpg"></p></li><li><p>选择打开新窗口<br><img src="https://i.loli.net/2020/11/19/SorBZD7w5UJkfbm.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/19/SorBZD7w5UJkfbm.png" srcset="data:image/png;base64,666" alt="20201119_3.jpg"></p></li></ol><h2 id="项目子工程配置"><a href="#项目子工程配置" class="headerlink" title="项目子工程配置"></a>项目子工程配置</h2><h3 id="配置Maven"><a href="#配置Maven" class="headerlink" title="配置Maven"></a>配置Maven</h3><ol><li>File -&gt; Settings -&gt; OK<br><img src="https://i.loli.net/2020/11/19/oO2StVpT7iPZkYr.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/19/oO2StVpT7iPZkYr.png" srcset="data:image/png;base64,666" alt="20201119_5.jpg"></li></ol><h3 id="新建Module文件"><a href="#新建Module文件" class="headerlink" title="新建Module文件"></a>新建Module文件</h3><ol><li><p>项目上右击 -&gt; New -&gt; Module<br><img src="https://i.loli.net/2020/11/19/HwXy316SuYQ7L4E.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/19/HwXy316SuYQ7L4E.png" srcset="data:image/png;base64,666" alt="20201119_4.jpg"></p></li><li><p>选择java -&gt; Next<br><img src="https://i.loli.net/2020/11/19/BH5sdGnhqiEFDUv.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/19/BH5sdGnhqiEFDUv.png" srcset="data:image/png;base64,666" alt="20201119_6.jpg"></p></li><li><p>设置中台模块名称<br><img src="https://i.loli.net/2020/11/19/jcRfaSLT37sK956.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/19/jcRfaSLT37sK956.png" srcset="data:image/png;base64,666" alt="20201119_7.jpg"></p></li><li><p>其他同级模块新建同理，比如前台，docs，sql等，最终呈现如图所示：<br><img src="https://i.loli.net/2020/11/19/FKQ7DijYWXytxdr.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/19/FKQ7DijYWXytxdr.png" srcset="data:image/png;base64,666" alt="20201119_8.jpg"></p></li></ol><h3 id="新建maven项目"><a href="#新建maven项目" class="headerlink" title="新建maven项目"></a>新建maven项目</h3><ol><li><p>项目上右击(如middle) -&gt; New -&gt; Module -&gt; Maven -&gt; quickstart -&gt;Next<br><img src="https://i.loli.net/2020/11/19/Vtwfn53o6eKFjAp.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/19/Vtwfn53o6eKFjAp.png" srcset="data:image/png;base64,666" alt="20201119_9.jpg"></p></li><li><p>设置ArtifactId，groupId为组织名，一般为公司网址反写 -&gt; Next<br><img src="https://i.loli.net/2020/11/19/7UchfKAoGlgwX4L.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/19/7UchfKAoGlgwX4L.png" srcset="data:image/png;base64,666" alt="20201119_10.jpg"></p></li><li><p>设置工程名称(在根目录下新加同名子文件夹) -&gt; Finish<br><img src="https://i.loli.net/2020/11/19/czsI92GtQM6D8dS.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/19/czsI92GtQM6D8dS.png" srcset="data:image/png;base64,666" alt="20201119_11.jpg"></p></li><li><p>创建resources文件夹:</p><ul><li><p>右击main -&gt; New -&gt; Directory<br><img src="https://i.loli.net/2020/11/19/ALsRBygK2H7Wcnx.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/19/ALsRBygK2H7Wcnx.png" srcset="data:image/png;base64,666" alt="20201119_12.jpg"></p></li><li><p>右击resources, 变成有黄色的横杠,作为资源根目录<br><img src="https://i.loli.net/2020/11/19/OzhqiK2DVgTyN3F.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/19/OzhqiK2DVgTyN3F.png" srcset="data:image/png;base64,666" alt="20201119_13.jpg"></p></li></ul></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本项目基于idea+maven组合&lt;/p&gt;
&lt;h2 id=&quot;项目父工程配置&quot;&gt;&lt;a href=&quot;#项目父工程配置&quot; class=&quot;headerlink&quot; title=&quot;项目父工程配置&quot;&gt;&lt;/a&gt;项目父工程配置&lt;/h2&gt;&lt;h3 id=&quot;Idea创建工程：&quot;&gt;&lt;a href=&quot;</summary>
      
    
    
    
    
  </entry>
  
</feed>
